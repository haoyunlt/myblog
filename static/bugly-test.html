<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bugly æµ‹è¯•ä¸è¯Šæ–­</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }
        
        h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #555;
            border-left: 4px solid #409eff;
            padding-left: 10px;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .status.success {
            background: #f0f9ff;
            color: #0c63e4;
        }
        
        .status.error {
            background: #fef0f0;
            color: #f56c6c;
        }
        
        .status.warning {
            background: #fdf6ec;
            color: #e6a23c;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
        }
        
        button.primary {
            background: #409eff;
            color: white;
        }
        
        button.primary:hover {
            background: #66b1ff;
        }
        
        button.danger {
            background: #f56c6c;
            color: white;
        }
        
        button.danger:hover {
            background: #f78989;
        }
        
        button.success {
            background: #67c23a;
            color: white;
        }
        
        button.success:hover {
            background: #85ce61;
        }
        
        pre {
            background: #f5f7fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.6;
        }
        
        .info {
            padding: 15px;
            background: #ecf5ff;
            border-left: 4px solid #409eff;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .count {
            font-size: 32px;
            font-weight: bold;
            color: #409eff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ğŸ”§ Bugly ç³»ç»Ÿè¯Šæ–­</h1>
            <p>æ£€æŸ¥ Bugly é”™è¯¯æŠ¥å‘Šç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€</p>
        </div>
        
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div id="statusContainer"></div>
        </div>
        
        <div class="card">
            <h2>ğŸ“ æœ¬åœ°å­˜å‚¨æ•°æ®</h2>
            <div class="info">
                å½“å‰æŠ¥å‘Šæ•°é‡: <span class="count" id="reportCount">0</span>
            </div>
            <div id="localDataContainer"></div>
        </div>
        
        <div class="card">
            <h2>ğŸ§ª æµ‹è¯•å·¥å…·</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•é”™è¯¯æŠ¥å‘ŠåŠŸèƒ½ï¼š</p>
            <div style="margin-top: 15px;">
                <button class="danger" onclick="testJavaScriptError()">æµ‹è¯• JavaScript é”™è¯¯</button>
                <button class="danger" onclick="testResourceError()">æµ‹è¯•èµ„æºé”™è¯¯</button>
                <button class="danger" onclick="testPromiseRejection()">æµ‹è¯• Promise æ‹’ç»</button>
                <button class="primary" onclick="testCustomError()">æµ‹è¯•è‡ªå®šä¹‰é”™è¯¯</button>
                <button class="success" onclick="checkData()">åˆ·æ–°æ•°æ®</button>
            </div>
        </div>
        
        <div class="card">
            <h2>ğŸ”— å¿«é€Ÿé“¾æ¥</h2>
            <button class="primary" onclick="window.open('/bugly-dashboard.html', '_blank')">
                ğŸ“Š æ‰“å¼€ Bugly ä»ªè¡¨æ¿
            </button>
            <button class="success" onclick="exportData()">
                ğŸ“¥ å¯¼å‡ºæ•°æ®
            </button>
            <button class="danger" onclick="clearData()">
                ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
            </button>
        </div>
        
        <div class="card">
            <h2>ğŸ’¡ æ•…éšœæ’æŸ¥æç¤º</h2>
            <div class="info">
                <strong>å¦‚æœä»ªè¡¨æ¿æ²¡æœ‰æ•°æ®ï¼Œå¯èƒ½çš„åŸå› ï¼š</strong>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>ä½ åœ¨æ¡Œé¢æµè§ˆå™¨è®¿é—®ï¼ˆBugly é»˜è®¤åªåœ¨ç§»åŠ¨è®¾å¤‡å¯ç”¨ï¼‰</li>
                    <li>æ²¡æœ‰å‘ç”Ÿä»»ä½•é”™è¯¯ï¼ˆç³»ç»Ÿè¿è¡Œæ­£å¸¸ï¼‰</li>
                    <li>bugly-report.js è„šæœ¬æœªæ­£ç¡®åŠ è½½</li>
                    <li>localStorage è¢«æ¸…é™¤æˆ–ç¦ç”¨</li>
                </ol>
                <p style="margin-top: 10px;"><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>ä½¿ç”¨ç§»åŠ¨è®¾å¤‡è®¿é—®æˆ–åœ¨å¼€å‘è€…å·¥å…·ä¸­å¯ç”¨ç§»åŠ¨æ¨¡æ‹Ÿ</li>
                    <li>ç‚¹å‡»ä¸Šæ–¹çš„æµ‹è¯•æŒ‰é’®ç”Ÿæˆæµ‹è¯•é”™è¯¯</li>
                    <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ç¡®è®¤è„šæœ¬å·²åŠ è½½</li>
                    <li>ç¡®ä¿æµè§ˆå™¨å…è®¸ localStorage</li>
                </ol>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½ Bugly è„šæœ¬ -->
    <script src="/js/bugly-report.js"></script>
    <script src="/js/mobile-error-handler.js"></script>
    
    <script>
        // è¯Šæ–­è„šæœ¬
        (function() {
            'use strict';
            
            // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
            function checkStatus() {
                const statusContainer = document.getElementById('statusContainer');
                const statuses = [];
                
                // æ£€æŸ¥ Bugly Reporter
                if (window.BuglyReporter) {
                    statuses.push({
                        type: 'success',
                        message: 'âœ… BuglyReporter å·²åŠ è½½'
                    });
                } else {
                    statuses.push({
                        type: 'error',
                        message: 'âŒ BuglyReporter æœªåŠ è½½ï¼ˆå¯èƒ½å› ä¸ºè®¾å¤‡æ£€æµ‹ï¼‰'
                    });
                }
                
                // æ£€æŸ¥é”™è¯¯å¤„ç†å™¨
                if (window.MobileErrorHandler) {
                    statuses.push({
                        type: 'success',
                        message: 'âœ… MobileErrorHandler å·²åŠ è½½'
                    });
                } else {
                    statuses.push({
                        type: 'warning',
                        message: 'âš ï¸ MobileErrorHandler æœªåŠ è½½'
                    });
                }
                
                // æ£€æŸ¥ localStorage
                try {
                    localStorage.setItem('test', 'test');
                    localStorage.removeItem('test');
                    statuses.push({
                        type: 'success',
                        message: 'âœ… localStorage å¯ç”¨'
                    });
                } catch (e) {
                    statuses.push({
                        type: 'error',
                        message: 'âŒ localStorage ä¸å¯ç”¨: ' + e.message
                    });
                }
                
                // æ£€æŸ¥è®¾å¤‡ç±»å‹
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                                 window.innerWidth <= 768;
                statuses.push({
                    type: isMobile ? 'success' : 'warning',
                    message: isMobile ? 'âœ… ç§»åŠ¨è®¾å¤‡' : 'âš ï¸ æ¡Œé¢è®¾å¤‡ï¼ˆBugly é»˜è®¤ç¦ç”¨ï¼‰'
                });
                
                // æ£€æŸ¥æŠ¥å‘Šå‡½æ•°
                if (window.reportToBugly) {
                    statuses.push({
                        type: 'success',
                        message: 'âœ… reportToBugly å‡½æ•°å¯ç”¨'
                    });
                } else {
                    statuses.push({
                        type: 'error',
                        message: 'âŒ reportToBugly å‡½æ•°ä¸å¯ç”¨'
                    });
                }
                
                // æ¸²æŸ“çŠ¶æ€
                statusContainer.innerHTML = statuses.map(status => 
                    `<div class="status ${status.type}">${status.message}</div>`
                ).join('');
            }
            
            // æ£€æŸ¥æœ¬åœ°æ•°æ®
            function checkLocalData() {
                try {
                    const reports = JSON.parse(localStorage.getItem('bugly_reports') || '[]');
                    const count = reports.length;
                    
                    document.getElementById('reportCount').textContent = count;
                    
                    const container = document.getElementById('localDataContainer');
                    
                    if (count === 0) {
                        container.innerHTML = '<div class="status warning">âš ï¸ æ²¡æœ‰æŠ¥å‘Šæ•°æ®</div>';
                    } else {
                        const latest = reports.slice(-5).reverse();
                        container.innerHTML = `
                            <div class="status success">æ‰¾åˆ° ${count} æ¡æŠ¥å‘Šï¼Œæ˜¾ç¤ºæœ€è¿‘ 5 æ¡ï¼š</div>
                            <pre>${JSON.stringify(latest, null, 2)}</pre>
                        `;
                    }
                } catch (e) {
                    document.getElementById('localDataContainer').innerHTML = 
                        `<div class="status error">âŒ è¯»å–å¤±è´¥: ${e.message}</div>`;
                }
            }
            
            // æµ‹è¯• JavaScript é”™è¯¯
            window.testJavaScriptError = function() {
                try {
                    // æ•…æ„è§¦å‘é”™è¯¯
                    throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯• JavaScript é”™è¯¯');
                } catch (e) {
                    if (window.reportToBugly) {
                        window.reportToBugly({
                            message: 'æµ‹è¯• JavaScript é”™è¯¯',
                            stack: e.stack,
                            level: 'error'
                        });
                        alert('âœ… JavaScript é”™è¯¯å·²æŠ¥å‘Šï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•°æ®ã€‚');
                    } else {
                        alert('âŒ reportToBugly å‡½æ•°ä¸å¯ç”¨ã€‚Bugly å¯èƒ½æœªåœ¨æ­¤è®¾å¤‡ä¸Šå¯ç”¨ã€‚');
                    }
                }
            };
            
            // æµ‹è¯•èµ„æºé”™è¯¯
            window.testResourceError = function() {
                const img = document.createElement('img');
                img.src = '/non-existent-image-' + Date.now() + '.jpg';
                img.style.display = 'none';
                document.body.appendChild(img);
                alert('âœ… èµ„æºé”™è¯¯å·²è§¦å‘ï¼ç­‰å¾… 2 ç§’ååˆ·æ–°é¡µé¢æŸ¥çœ‹æ•°æ®ã€‚');
            };
            
            // æµ‹è¯• Promise æ‹’ç»
            window.testPromiseRejection = function() {
                Promise.reject(new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯• Promise æ‹’ç»')).catch(e => {
                    if (window.reportToBugly) {
                        window.reportToBugly({
                            message: 'æµ‹è¯• Promise æ‹’ç»',
                            stack: e.stack,
                            level: 'error'
                        });
                    }
                });
                alert('âœ… Promise æ‹’ç»å·²è§¦å‘ï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•°æ®ã€‚');
            };
            
            // æµ‹è¯•è‡ªå®šä¹‰é”™è¯¯
            window.testCustomError = function() {
                if (window.reportToBugly) {
                    window.reportToBugly({
                        message: 'è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æµ‹è¯•é”™è¯¯',
                        level: 'info',
                        extra: {
                            test: true,
                            timestamp: Date.now(),
                            userAgent: navigator.userAgent
                        }
                    });
                    alert('âœ… è‡ªå®šä¹‰é”™è¯¯å·²æŠ¥å‘Šï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹æ•°æ®ã€‚');
                } else {
                    alert('âŒ reportToBugly å‡½æ•°ä¸å¯ç”¨');
                }
            };
            
            // åˆ·æ–°æ•°æ®
            window.checkData = function() {
                checkStatus();
                checkLocalData();
                alert('âœ… æ•°æ®å·²åˆ·æ–°ï¼');
            };
            
            // å¯¼å‡ºæ•°æ®
            window.exportData = function() {
                try {
                    const reports = localStorage.getItem('bugly_reports') || '[]';
                    const blob = new Blob([reports], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `bugly-reports-${Date.now()}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                } catch (e) {
                    alert('å¯¼å‡ºå¤±è´¥: ' + e.message);
                }
            };
            
            // æ¸…é™¤æ•°æ®
            window.clearData = function() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æŠ¥å‘Šæ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    try {
                        localStorage.removeItem('bugly_reports');
                        localStorage.removeItem('mobile_error_handler_errors');
                        alert('âœ… æ•°æ®å·²æ¸…é™¤ï¼');
                        checkData();
                    } catch (e) {
                        alert('æ¸…é™¤å¤±è´¥: ' + e.message);
                    }
                }
            };
            
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
            window.addEventListener('load', function() {
                setTimeout(function() {
                    checkStatus();
                    checkLocalData();
                }, 500);
            });
            
        })();
    </script>
</body>
</html>

